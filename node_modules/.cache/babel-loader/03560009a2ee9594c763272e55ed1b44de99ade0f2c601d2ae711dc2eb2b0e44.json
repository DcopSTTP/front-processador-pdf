{"ast":null,"code":"// Handlers para o App component\nimport Swal from 'sweetalert2';\nimport { validateFile } from './fileUtils';\nimport { extractDataFromPDF, generateNewPDF, saveDataToBackend } from './pdfUtils';\nexport const createHandlers = (setError, setExtractedData, setUploading, setUploadedFile, setProcessing, fileInputRef, setDragActive, uploadedFile, extractedData, onViewDetails) => {\n  // Event Handlers\n  const handleDrag = e => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (e.type === \"dragenter\" || e.type === \"dragover\") {\n      setDragActive(true);\n    } else if (e.type === \"dragleave\") {\n      setDragActive(false);\n    }\n  };\n  const handleDrop = e => {\n    e.preventDefault();\n    e.stopPropagation();\n    setDragActive(false);\n    if (e.dataTransfer.files && e.dataTransfer.files[0]) {\n      handleFile(e.dataTransfer.files[0]);\n    }\n  };\n  const handleFileSelect = e => {\n    if (e.target.files && e.target.files[0]) {\n      handleFile(e.target.files[0]);\n    }\n  };\n\n  // File Operations\n  const handleFile = async file => {\n    setError('');\n    setExtractedData(null);\n    const validation = validateFile(file);\n    if (!validation.isValid) {\n      setError(validation.errors[0]);\n      return;\n    }\n    setUploading(true);\n    setTimeout(() => {\n      setUploadedFile({\n        name: file.name,\n        size: file.size,\n        type: file.type,\n        lastModified: file.lastModified,\n        file: file\n      });\n      setUploading(false);\n    }, 1000);\n  };\n  const processPDF = async () => {\n    if (!(uploadedFile !== null && uploadedFile !== void 0 && uploadedFile.file)) return;\n    setProcessing(true);\n    setError('');\n    try {\n      const data = await extractDataFromPDF(uploadedFile.file);\n      setExtractedData(data);\n    } catch (err) {\n      setError('Erro ao processar PDF: ' + err.message);\n    } finally {\n      setProcessing(false);\n    }\n  };\n  const downloadReport = async () => {\n    if (!extractedData) return;\n    try {\n      await generateNewPDF(extractedData);\n    } catch (err) {\n      setError('Erro ao gerar relat√≥rio: ' + err.message);\n    }\n  };\n  const saveToBackend = async dataToSave => {\n    // Se n√£o receber dados como par√¢metro, usar extractedData\n    const data = dataToSave || extractedData;\n    if (!data) return;\n    try {\n      // Mostrar loading\n      Swal.fire({\n        title: 'Salvando dados...',\n        text: 'Por favor, aguarde enquanto os dados s√£o enviados para o sistema.',\n        allowOutsideClick: false,\n        allowEscapeKey: false,\n        showConfirmButton: false,\n        didOpen: () => {\n          Swal.showLoading();\n        }\n      });\n      const result = await saveDataToBackend(data);\n\n      // Extrair informa√ß√µes do resultado para exibir\n      const ocorrencia = result.data || result;\n      const numeroOcorrencia = ocorrencia.numeroOcorrencia || 'N/A';\n      const dataHora = ocorrencia.createdAt ? new Date(ocorrencia.createdAt).toLocaleString('pt-BR') : 'N/A';\n\n      // Mostrar sucesso com detalhes e op√ß√£o de visualizar\n      const resultado = await Swal.fire({\n        icon: 'success',\n        title: 'Ocorr√™ncia Salva!',\n        html: `\n          <div style=\"text-align: left; margin: 10px 0;\">\n            <p><strong>N√∫mero:</strong> ${numeroOcorrencia}</p>\n            <p><strong>Salva em:</strong> ${dataHora}</p>\n            <p><strong>Status:</strong> Processada e armazenada no sistema</p>\n          </div>\n        `,\n        showCancelButton: true,\n        confirmButtonText: 'üëÅÔ∏è Visualizar Dados',\n        cancelButtonText: 'OK',\n        confirmButtonColor: '#3b82f6',\n        cancelButtonColor: '#10b981',\n        width: '500px',\n        reverseButtons: true\n      });\n\n      // Se o usu√°rio escolheu visualizar os dados\n      if (resultado.isConfirmed && ocorrencia.id) {\n        // Chamar callback para navegar para detalhes (ser√° passado pelo componente pai)\n        if (onViewDetails) {\n          onViewDetails(ocorrencia.id);\n        }\n      }\n    } catch (err) {\n      // Mostrar erro\n      Swal.fire({\n        icon: 'error',\n        title: 'Erro ao salvar',\n        text: err.message || 'Ocorreu um erro ao tentar salvar os dados no sistema.',\n        confirmButtonText: 'OK',\n        confirmButtonColor: '#ef4444'\n      });\n      setError('Erro ao salvar dados: ' + err.message);\n    }\n  };\n  const removeFile = () => {\n    setUploadedFile(null);\n    setExtractedData(null);\n    setError('');\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n  };\n  const openFileDialog = () => {\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n      fileInputRef.current.click();\n    }\n  };\n  return {\n    handleDrag,\n    handleDrop,\n    handleFileSelect,\n    handleFile,\n    processPDF,\n    downloadReport,\n    saveToBackend,\n    removeFile,\n    openFileDialog\n  };\n};","map":{"version":3,"names":["Swal","validateFile","extractDataFromPDF","generateNewPDF","saveDataToBackend","createHandlers","setError","setExtractedData","setUploading","setUploadedFile","setProcessing","fileInputRef","setDragActive","uploadedFile","extractedData","onViewDetails","handleDrag","e","preventDefault","stopPropagation","type","handleDrop","dataTransfer","files","handleFile","handleFileSelect","target","file","validation","isValid","errors","setTimeout","name","size","lastModified","processPDF","data","err","message","downloadReport","saveToBackend","dataToSave","fire","title","text","allowOutsideClick","allowEscapeKey","showConfirmButton","didOpen","showLoading","result","ocorrencia","numeroOcorrencia","dataHora","createdAt","Date","toLocaleString","resultado","icon","html","showCancelButton","confirmButtonText","cancelButtonText","confirmButtonColor","cancelButtonColor","width","reverseButtons","isConfirmed","id","removeFile","current","value","openFileDialog","click"],"sources":["/Users/lohuamalima/Desktop/sttp/ocorrencias-de-transito/src/utils/handlers.js"],"sourcesContent":["// Handlers para o App component\nimport Swal from 'sweetalert2';\nimport { validateFile } from './fileUtils';\nimport { extractDataFromPDF, generateNewPDF, saveDataToBackend } from './pdfUtils';\n\nexport const createHandlers = (\n  setError,\n  setExtractedData,\n  setUploading,\n  setUploadedFile,\n  setProcessing,\n  fileInputRef,\n  setDragActive,\n  uploadedFile,\n  extractedData,\n  onViewDetails\n) => {\n  // Event Handlers\n  const handleDrag = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (e.type === \"dragenter\" || e.type === \"dragover\") {\n      setDragActive(true);\n    } else if (e.type === \"dragleave\") {\n      setDragActive(false);\n    }\n  };\n\n  const handleDrop = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setDragActive(false);\n    \n    if (e.dataTransfer.files && e.dataTransfer.files[0]) {\n      handleFile(e.dataTransfer.files[0]);\n    }\n  };\n\n  const handleFileSelect = (e) => {\n    if (e.target.files && e.target.files[0]) {\n      handleFile(e.target.files[0]);\n    }\n  };\n\n  // File Operations\n  const handleFile = async (file) => {\n    setError('');\n    setExtractedData(null);\n    \n    const validation = validateFile(file);\n    if (!validation.isValid) {\n      setError(validation.errors[0]);\n      return;\n    }\n\n    setUploading(true);\n    \n    setTimeout(() => {\n      setUploadedFile({\n        name: file.name,\n        size: file.size,\n        type: file.type,\n        lastModified: file.lastModified,\n        file: file\n      });\n      setUploading(false);\n    }, 1000);\n  };\n\n  const processPDF = async () => {\n    if (!uploadedFile?.file) return;\n    \n    setProcessing(true);\n    setError('');\n    \n    try {\n      const data = await extractDataFromPDF(uploadedFile.file);\n      setExtractedData(data);\n    } catch (err) {\n      setError('Erro ao processar PDF: ' + err.message);\n    } finally {\n      setProcessing(false);\n    }\n  };\n\n  const downloadReport = async () => {\n    if (!extractedData) return;\n    \n    try {\n      await generateNewPDF(extractedData);\n    } catch (err) {\n      setError('Erro ao gerar relat√≥rio: ' + err.message);\n    }\n  };\n\n  const saveToBackend = async (dataToSave) => {\n    // Se n√£o receber dados como par√¢metro, usar extractedData\n    const data = dataToSave || extractedData;\n    if (!data) return;\n    \n    try {\n      // Mostrar loading\n      Swal.fire({\n        title: 'Salvando dados...',\n        text: 'Por favor, aguarde enquanto os dados s√£o enviados para o sistema.',\n        allowOutsideClick: false,\n        allowEscapeKey: false,\n        showConfirmButton: false,\n        didOpen: () => {\n          Swal.showLoading();\n        }\n      });\n\n      const result = await saveDataToBackend(data);\n      \n      // Extrair informa√ß√µes do resultado para exibir\n      const ocorrencia = result.data || result;\n      const numeroOcorrencia = ocorrencia.numeroOcorrencia || 'N/A';\n      const dataHora = ocorrencia.createdAt ? new Date(ocorrencia.createdAt).toLocaleString('pt-BR') : 'N/A';\n      \n      // Mostrar sucesso com detalhes e op√ß√£o de visualizar\n      const resultado = await Swal.fire({\n        icon: 'success',\n        title: 'Ocorr√™ncia Salva!',\n        html: `\n          <div style=\"text-align: left; margin: 10px 0;\">\n            <p><strong>N√∫mero:</strong> ${numeroOcorrencia}</p>\n            <p><strong>Salva em:</strong> ${dataHora}</p>\n            <p><strong>Status:</strong> Processada e armazenada no sistema</p>\n          </div>\n        `,\n        showCancelButton: true,\n        confirmButtonText: 'üëÅÔ∏è Visualizar Dados',\n        cancelButtonText: 'OK',\n        confirmButtonColor: '#3b82f6',\n        cancelButtonColor: '#10b981',\n        width: '500px',\n        reverseButtons: true\n      });\n\n      // Se o usu√°rio escolheu visualizar os dados\n      if (resultado.isConfirmed && ocorrencia.id) {\n        // Chamar callback para navegar para detalhes (ser√° passado pelo componente pai)\n        if (onViewDetails) {\n          onViewDetails(ocorrencia.id);\n        }\n      }\n      \n    } catch (err) {\n      \n      // Mostrar erro\n      Swal.fire({\n        icon: 'error',\n        title: 'Erro ao salvar',\n        text: err.message || 'Ocorreu um erro ao tentar salvar os dados no sistema.',\n        confirmButtonText: 'OK',\n        confirmButtonColor: '#ef4444'\n      });\n      \n      setError('Erro ao salvar dados: ' + err.message);\n    }\n  };\n\n  const removeFile = () => {\n    setUploadedFile(null);\n    setExtractedData(null);\n    setError('');\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n  };\n\n  const openFileDialog = () => {\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n      fileInputRef.current.click();\n    }\n  };\n\n  return {\n    handleDrag,\n    handleDrop,\n    handleFileSelect,\n    handleFile,\n    processPDF,\n    downloadReport,\n    saveToBackend,\n    removeFile,\n    openFileDialog\n  };\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}